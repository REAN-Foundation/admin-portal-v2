<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Common Settings - REAN Admin Portal</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css">
  <style>
    .settings-progress-bar {
      background: var(--color-bg-primary);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-xl);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }
    
    .settings-progress-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1rem;
    }
    
    .settings-progress-header h3 {
      font-size: 1rem;
      font-weight: 600;
    }
    
    .settings-progress-header span {
      font-size: 0.875rem;
      color: var(--color-text-muted);
    }
    
    .progress-segments {
      display: flex;
      gap: 0.25rem;
      margin-bottom: 0.75rem;
    }
    
    .progress-segment {
      flex: 1;
      height: 8px;
      border-radius: var(--radius-full);
      background: var(--color-bg-tertiary);
      transition: background var(--transition-fast);
    }
    
    .progress-segment.active {
      background: var(--color-primary-500);
    }
    
    .progress-segment.partial {
      background: linear-gradient(90deg, var(--color-primary-500) 50%, var(--color-bg-tertiary) 50%);
    }
    
    .progress-labels {
      display: flex;
      justify-content: space-between;
      font-size: 0.75rem;
      color: var(--color-text-muted);
    }
    
    .settings-section {
      margin-bottom: 1rem;
    }
    
    .settings-section-header {
      background: var(--color-bg-primary);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-xl);
      padding: 1rem 1.5rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      transition: all var(--transition-fast);
    }
    
    .settings-section-header:hover {
      border-color: var(--color-primary-400);
    }
    
    .settings-section.open .settings-section-header {
      border-bottom-left-radius: 0;
      border-bottom-right-radius: 0;
      border-color: var(--color-primary-400);
    }
    
    .settings-section-left {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    
    .section-icon {
      width: 44px;
      height: 44px;
      border-radius: var(--radius-lg);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }
    
    .section-icon.clinical { background: #fef2f2; color: #dc2626; }
    .section-icon.wellness { background: #f0fdf4; color: #16a34a; }
    .section-icon.ehr { background: #eff6ff; color: #2563eb; }
    .section-icon.affiliations { background: #fefce8; color: #ca8a04; }
    .section-icon.community { background: #fdf4ff; color: #a855f7; }
    .section-icon.educational { background: #fff7ed; color: #ea580c; }
    .section-icon.miscellaneous { background: #f1f5f9; color: #475569; }
    .section-icon.analysis { background: #ecfeff; color: #0891b2; }
    
    .section-info h3 {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
    }
    
    .section-info p {
      font-size: 0.8125rem;
      color: var(--color-text-muted);
    }
    
    .settings-section-right {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    
    .section-progress {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .section-progress-bar {
      width: 100px;
      height: 6px;
      background: var(--color-bg-tertiary);
      border-radius: var(--radius-full);
      overflow: hidden;
    }
    
    .section-progress-fill {
      height: 100%;
      background: var(--color-primary-500);
      border-radius: var(--radius-full);
      transition: width var(--transition-slow);
    }
    
    .section-progress-text {
      font-size: 0.8125rem;
      font-weight: 500;
      color: var(--color-text-muted);
      min-width: 36px;
    }
    
    .section-arrow {
      width: 24px;
      height: 24px;
      color: var(--color-neutral-400);
      transition: transform var(--transition-fast);
    }
    
    .settings-section.open .section-arrow {
      transform: rotate(180deg);
    }
    
    .settings-section-content {
      display: none;
      background: var(--color-bg-secondary);
      border: 1px solid var(--color-primary-400);
      border-top: none;
      border-radius: 0 0 var(--radius-xl) var(--radius-xl);
      padding: 1.5rem;
    }
    
    .settings-section.open .settings-section-content {
      display: block;
    }
    
    .settings-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1rem;
    }
    
    .setting-item {
      background: var(--color-bg-primary);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-lg);
      padding: 1rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      transition: all var(--transition-fast);
    }
    
    .setting-item:hover {
      border-color: var(--color-primary-400);
    }
    
    .setting-item.enabled {
      border-color: var(--color-success-400);
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.05) 0%, var(--color-bg-primary) 100%);
    }
    
    .setting-item-icon {
      width: 36px;
      height: 36px;
      border-radius: var(--radius-md);
      background: var(--color-bg-tertiary);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--color-text-secondary);
      flex-shrink: 0;
    }
    
    .setting-item.enabled .setting-item-icon {
      background: var(--color-success-50);
      color: var(--color-success-600);
    }
    
    .setting-item-info {
      flex: 1;
      min-width: 0;
    }
    
    .setting-item-info h4 {
      font-size: 0.875rem;
      font-weight: 500;
      margin-bottom: 0.125rem;
    }
    
    .setting-item-info p {
      font-size: 0.75rem;
      color: var(--color-text-muted);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .edit-mode-banner {
      background: linear-gradient(135deg, var(--color-warning-50) 0%, var(--color-bg-primary) 100%);
      border: 1px solid var(--color-warning-500);
      border-radius: var(--radius-xl);
      padding: 1rem 1.5rem;
      margin-bottom: 1.5rem;
      display: none;
      align-items: center;
      justify-content: space-between;
    }
    
    .edit-mode-banner.active {
      display: flex;
    }
    
    .edit-mode-banner-left {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    
    .edit-mode-banner-icon {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-lg);
      background: var(--color-warning-100);
      color: var(--color-warning-600);
      display: flex;
      align-items: center;
      justify-content: center;
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar"></aside>
    
    <!-- Main Content -->
    <main class="main-content">
      <!-- Navbar -->
      <header class="navbar" id="navbar"></header>
      
      <!-- Page Content -->
      <div class="page-container">
        <!-- Header -->
        <div class="page-header" style="display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 1rem;">
          <div>
            <h1 class="page-title">Common Settings</h1>
            <p class="page-subtitle">Configure feature toggles and system-wide settings</p>
          </div>
          <div style="display: flex; gap: 0.75rem;">
            <button class="btn btn-secondary" onclick="toggleEditMode()">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/>
                <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/>
              </svg>
              <span id="editBtnText">Edit Settings</span>
            </button>
            <a href="tenant-settings.html" class="btn btn-ghost">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 12H5"/>
                <polyline points="12 19 5 12 12 5"/>
              </svg>
              Back
            </a>
          </div>
        </div>
        
        <!-- Edit Mode Banner -->
        <div class="edit-mode-banner" id="editModeBanner">
          <div class="edit-mode-banner-left">
            <div class="edit-mode-banner-icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/>
                <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/>
              </svg>
            </div>
            <div>
              <div style="font-weight: 600; color: var(--color-warning-700);">Edit Mode Active</div>
              <div style="font-size: 0.8125rem; color: var(--color-text-muted);">You can now toggle settings on or off. Click Save to apply changes.</div>
            </div>
          </div>
          <button class="btn btn-primary" onclick="saveSettings()">Save Changes</button>
        </div>
        
        <!-- Progress Bar -->
        <div class="settings-progress-bar">
          <div class="settings-progress-header">
            <h3>Overall Configuration Progress</h3>
            <span id="overallProgress">68% Complete</span>
          </div>
          <div class="progress-segments">
            <div class="progress-segment active" title="Clinical"></div>
            <div class="progress-segment active" title="Wellness"></div>
            <div class="progress-segment partial" title="EHR"></div>
            <div class="progress-segment active" title="Affiliations"></div>
            <div class="progress-segment active" title="Community"></div>
            <div class="progress-segment partial" title="Educational"></div>
            <div class="progress-segment active" title="Misc"></div>
            <div class="progress-segment partial" title="Analysis"></div>
          </div>
          <div class="progress-labels">
            <span>Clinical</span>
            <span>Wellness</span>
            <span>EHR</span>
            <span>Affiliations</span>
            <span>Community</span>
            <span>Educational</span>
            <span>Misc</span>
            <span>Analysis</span>
          </div>
        </div>
        
        <!-- Settings Sections -->
        <div id="settingsSections">
          <!-- Will be populated by JavaScript -->
        </div>
      </div>
    </main>
  </div>
  
  <script src="js/data.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/sidebar.js"></script>
  <script>
    let editMode = false;
    let settingsState = JSON.parse(JSON.stringify(tenantSettingsConfig.common));
    
    const sectionIcons = {
      clinical: `<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4.8 2.3A.3.3 0 105 2H4a2 2 0 00-2 2v5a6 6 0 006 6v0a6 6 0 006-6V4a2 2 0 00-2-2h-1a.2.2 0 10.3.3"/><path d="M8 15v1a6 6 0 006 6v0a6 6 0 006-6v-4"/><circle cx="20" cy="10" r="2"/></svg>`,
      wellness: `<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22c4.97 0 9-2.24 9-5v-3.5M12 22c-4.97 0-9-2.24-9-5v-3.5M12 22V12M21 13.5c0-2.76-4.03-5-9-5s-9 2.24-9 5M12 7a3 3 0 100-6 3 3 0 000 6z"/></svg>`,
      ehr: `<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg>`,
      affiliations: `<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/></svg>`,
      community: `<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/></svg>`,
      educational: `<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 10v6M2 10l10-5 10 5-10 5z"/><path d="M6 12v5c3 3 9 3 12 0v-5"/></svg>`,
      miscellaneous: `<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/></svg>`,
      analysis: `<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>`
    };
    
    const settingIcons = {
      vitals: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>`,
      labRecords: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 3h6M9 3v6l-5 8.5a2 2 0 001.7 3h12.6a2 2 0 001.7-3L15 9V3"/></svg>`,
      symptoms: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>`,
      medications: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.5 20.5L3.5 13.5a4.95 4.95 0 117 -7l7 7a4.95 4.95 0 11-7 7z"/><path d="M8.5 8.5l7 7"/></svg>`,
      careplans: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg>`,
      default: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4"/></svg>`
    };
    
    document.addEventListener('DOMContentLoaded', () => {
      initializeLayout({
        currentPage: 'common-settings.html',
        breadcrumbs: [
          { name: 'Administration', href: '#' },
          { name: 'Tenants', href: 'tenants.html' },
          { name: 'Settings', href: 'tenant-settings.html' },
          { name: 'Common Settings', href: 'common-settings.html' }
        ],
        user: currentUser
      });
      
      renderSections();
    });
    
    function renderSections() {
      const container = document.getElementById('settingsSections');
      
      const html = Object.entries(settingsState).map(([key, section]) => {
        const enabledCount = section.settings.filter(s => s.enabled).length;
        const totalCount = section.settings.length;
        const progress = Math.round((enabledCount / totalCount) * 100);
        
        return `
          <div class="settings-section" data-section="${key}">
            <div class="settings-section-header" onclick="toggleSection('${key}')">
              <div class="settings-section-left">
                <div class="section-icon ${key}">
                  ${sectionIcons[key] || sectionIcons.default}
                </div>
                <div class="section-info">
                  <h3>${section.name}</h3>
                  <p>${section.description}</p>
                </div>
              </div>
              <div class="settings-section-right">
                <div class="section-progress">
                  <div class="section-progress-bar">
                    <div class="section-progress-fill" style="width: ${progress}%"></div>
                  </div>
                  <span class="section-progress-text">${progress}%</span>
                </div>
                <span class="badge ${enabledCount === totalCount ? 'badge-success' : 'badge-warning'}">
                  ${enabledCount}/${totalCount}
                </span>
                <svg class="section-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="6 9 12 15 18 9"/>
                </svg>
              </div>
            </div>
            <div class="settings-section-content">
              <div class="settings-grid">
                ${section.settings.map(setting => `
                  <div class="setting-item ${setting.enabled ? 'enabled' : ''}" data-key="${setting.key}">
                    <div class="setting-item-icon">
                      ${settingIcons[setting.key] || settingIcons.default}
                    </div>
                    <div class="setting-item-info">
                      <h4>${setting.name}</h4>
                      <p>${setting.description}</p>
                    </div>
                    <label class="toggle">
                      <input type="checkbox" ${setting.enabled ? 'checked' : ''} 
                             ${!editMode ? 'disabled' : ''} 
                             onchange="toggleSetting('${key}', '${setting.key}', this.checked)">
                      <span class="toggle-slider"></span>
                    </label>
                  </div>
                `).join('')}
              </div>
            </div>
          </div>
        `;
      }).join('');
      
      container.innerHTML = html;
    }
    
    function toggleSection(sectionKey) {
      const section = document.querySelector(`[data-section="${sectionKey}"]`);
      section.classList.toggle('open');
    }
    
    function toggleEditMode() {
      editMode = !editMode;
      document.getElementById('editModeBanner').classList.toggle('active', editMode);
      document.getElementById('editBtnText').textContent = editMode ? 'Cancel Edit' : 'Edit Settings';
      
      // Enable/disable all toggles
      document.querySelectorAll('.setting-item input[type="checkbox"]').forEach(input => {
        input.disabled = !editMode;
      });
      
      if (editMode) {
        Toast.info('Edit mode enabled. You can now toggle settings.');
      }
    }
    
    function toggleSetting(sectionKey, settingKey, enabled) {
      const section = settingsState[sectionKey];
      const setting = section.settings.find(s => s.key === settingKey);
      if (setting) {
        setting.enabled = enabled;
        
        // Update UI
        const settingItem = document.querySelector(`[data-section="${sectionKey}"] [data-key="${settingKey}"]`);
        settingItem.classList.toggle('enabled', enabled);
        
        // Update progress
        updateSectionProgress(sectionKey);
      }
    }
    
    function updateSectionProgress(sectionKey) {
      const section = settingsState[sectionKey];
      const enabledCount = section.settings.filter(s => s.enabled).length;
      const totalCount = section.settings.length;
      const progress = Math.round((enabledCount / totalCount) * 100);
      
      const sectionEl = document.querySelector(`[data-section="${sectionKey}"]`);
      const progressFill = sectionEl.querySelector('.section-progress-fill');
      const progressText = sectionEl.querySelector('.section-progress-text');
      const badge = sectionEl.querySelector('.badge');
      
      progressFill.style.width = `${progress}%`;
      progressText.textContent = `${progress}%`;
      badge.textContent = `${enabledCount}/${totalCount}`;
      badge.className = `badge ${enabledCount === totalCount ? 'badge-success' : 'badge-warning'}`;
      
      // Update overall progress
      updateOverallProgress();
    }
    
    function updateOverallProgress() {
      let totalEnabled = 0;
      let totalSettings = 0;
      
      Object.values(settingsState).forEach(section => {
        totalEnabled += section.settings.filter(s => s.enabled).length;
        totalSettings += section.settings.length;
      });
      
      const overallProgress = Math.round((totalEnabled / totalSettings) * 100);
      document.getElementById('overallProgress').textContent = `${overallProgress}% Complete`;
    }
    
    function saveSettings() {
      Toast.success('Settings saved successfully!');
      toggleEditMode();
    }
  </script>
</body>
</html>
