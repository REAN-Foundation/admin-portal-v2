<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Assessment Nodes - REAN Admin Portal</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css">
  <style>
    .template-banner {
      background: linear-gradient(135deg, rgba(51, 89, 255, 0.05), rgba(51, 89, 255, 0.02));
      border: 1px solid rgba(51, 89, 255, 0.2);
      border-radius: var(--radius-lg);
      padding: 1rem 1.25rem;
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .node-type-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.375rem;
      padding: 0.25rem 0.625rem;
      border-radius: var(--radius-md);
      font-size: 0.75rem;
      font-weight: 500;
    }
    
    .node-type-badge.question { background: rgba(51, 89, 255, 0.1); color: var(--color-primary-500); }
    .node-type-badge.message { background: rgba(16, 185, 129, 0.1); color: var(--color-success-500); }
    .node-type-badge.list { background: rgba(245, 158, 11, 0.1); color: var(--color-warning-500); }
    
    .query-type-badge {
      padding: 0.125rem 0.5rem;
      background: var(--color-surface-alt);
      border-radius: var(--radius-sm);
      font-size: 0.6875rem;
      color: var(--color-text-muted);
    }
    
    .root-node-row {
      background: rgba(245, 158, 11, 0.05);
    }
    
    .root-node-row td {
      color: var(--color-text-muted);
    }
    
    .sortable {
      cursor: pointer;
      user-select: none;
    }
    
    .sortable:hover {
      color: var(--color-primary-500);
    }
    
    .sortable svg {
      opacity: 0.3;
      transition: opacity 0.2s;
    }
    
    .sortable:hover svg,
    .sortable.active svg {
      opacity: 1;
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar"></aside>
    
    <!-- Main Content -->
    <main class="main-content">
      <!-- Navbar -->
      <header class="navbar" id="navbar"></header>
      
      <!-- Page Content -->
      <div class="page-container">
        <!-- Template Info Banner -->
        <div class="template-banner">
          <div style="display: flex; align-items: center; gap: 0.75rem;">
            <div style="width: 40px; height: 40px; background: rgba(51, 89, 255, 0.1); border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center;">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--color-primary-500)" stroke-width="2">
                <path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/>
                <rect x="8" y="2" width="8" height="4" rx="1" ry="1"/>
              </svg>
            </div>
            <div>
              <div style="font-weight: 600; color: var(--color-primary-600);">Patient Health Questionnaire (PHQ-9)</div>
              <div style="font-size: 0.8125rem; color: var(--color-primary-500);">Clinical Assessment - 10 nodes</div>
            </div>
          </div>
          <a href="assessment-template-view.html" style="display: flex; align-items: center; gap: 0.375rem; font-size: 0.875rem; color: var(--color-primary-500); font-weight: 500; text-decoration: none;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="19" y1="12" x2="5" y2="12"/>
              <polyline points="12 19 5 12 12 5"/>
            </svg>
            Back to Template
          </a>
        </div>
        
        <!-- Table -->
        <div class="table-container">
          <div class="table-header">
            <div class="table-search">
              <span class="table-search-icon">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="11" cy="11" r="8"/>
                  <path d="M21 21l-4.35-4.35"/>
                </svg>
              </span>
              <input type="text" placeholder="Search by title..." id="searchTitle" oninput="filterNodes()">
            </div>
            <div style="display: flex; gap: 0.5rem;">
              <input type="text" class="form-input" placeholder="Search node type..." id="searchNodeType" oninput="filterNodes()" style="width: 150px;">
              <input type="text" class="form-input" placeholder="Search tags..." id="searchTags" oninput="filterNodes()" style="width: 140px;">
              <a href="assessment-node-view.html?mode=create" class="btn btn-primary">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="12" y1="5" x2="12" y2="19"/>
                  <line x1="5" y1="12" x2="19" y2="12"/>
                </svg>
                Add New
              </a>
            </div>
          </div>
          
          <table class="table">
            <thead>
              <tr>
                <th style="width: 5%;">Id</th>
                <th style="width: 30%;" class="sortable" onclick="sortTable('title')">
                  Title
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline; vertical-align: middle;">
                    <path d="M7 15l5 5 5-5"/>
                    <path d="M7 9l5-5 5 5"/>
                  </svg>
                </th>
                <th style="width: 13%;" class="sortable" onclick="sortTable('nodeType')">
                  Node Type
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline; vertical-align: middle;">
                    <path d="M7 15l5 5 5-5"/>
                    <path d="M7 9l5-5 5 5"/>
                  </svg>
                </th>
                <th style="width: 17%;">Query Response Type</th>
                <th style="width: 18%;">Tags</th>
                <th style="width: 12%; text-align: right;">Actions</th>
              </tr>
            </thead>
            <tbody id="nodesTableBody">
              <!-- Data will be populated by JavaScript -->
            </tbody>
          </table>
          
          <div class="table-footer">
            <div style="display: flex; align-items: center; gap: 0.5rem; color: var(--color-text-muted); font-size: 0.875rem;">
              <span>Rows per page:</span>
              <select class="form-input form-select" style="width: auto; padding: 0.25rem 0.5rem; font-size: 0.8125rem;">
                <option>10</option>
                <option>20</option>
                <option>30</option>
                <option>50</option>
              </select>
            </div>
            <div class="pagination">
              <span style="font-size: 0.875rem; color: var(--color-text-muted); margin-right: 1rem;">1-6 of 10</span>
              <button class="pagination-btn" disabled>
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="15 18 9 12 15 6"/>
                </svg>
              </button>
              <button class="pagination-btn">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="9 18 15 12 9 6"/>
                </svg>
              </button>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>
  
  <!-- Delete Confirmation Modal -->
  <div class="modal-overlay" id="deleteModal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Delete Assessment Node</h3>
        <button class="modal-close" onclick="closeDeleteModal()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 6L6 18M6 6l12 12"/>
          </svg>
        </button>
      </div>
      <div class="modal-body" style="text-align: center;">
        <div style="width: 64px; height: 64px; background: rgba(239, 68, 68, 0.1); border-radius: var(--radius-full); display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem;">
          <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="var(--color-error-500)" stroke-width="2">
            <polyline points="3 6 5 6 21 6"/>
            <path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
          </svg>
        </div>
        <p>Are you sure you want to delete "<strong id="deleteNodeName"></strong>"?</p>
        <p style="font-size: 0.875rem; color: var(--color-text-muted);">This action cannot be undone.</p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeDeleteModal()">Cancel</button>
        <button class="btn btn-danger" onclick="confirmDelete()">Delete</button>
      </div>
    </div>
  </div>
  
  <script src="js/data.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/sidebar.js"></script>
  <script>
    const nodesData = [
      { id: 1, title: 'Assessment root node', nodeType: 'Node list', nodeTypeClass: 'list', queryType: null, tags: null, isRoot: true },
      { id: 2, title: 'Little interest or pleasure in doing things?', nodeType: 'Question', nodeTypeClass: 'question', queryType: 'Single Choice Selection', tags: 'interest, pleasure' },
      { id: 3, title: 'Feeling down, depressed, or hopeless?', nodeType: 'Question', nodeTypeClass: 'question', queryType: 'Single Choice Selection', tags: 'depression, mood' },
      { id: 4, title: 'Trouble falling or staying asleep?', nodeType: 'Question', nodeTypeClass: 'question', queryType: 'Single Choice Selection', tags: 'sleep' },
      { id: 5, title: 'Feeling tired or having little energy?', nodeType: 'Question', nodeTypeClass: 'question', queryType: 'Single Choice Selection', tags: 'energy, fatigue' },
      { id: 6, title: 'Thank you for completing the assessment', nodeType: 'Message', nodeTypeClass: 'message', queryType: null, tags: 'completion' }
    ];
    
    let deleteTargetId = null;
    
    document.addEventListener('DOMContentLoaded', () => {
      initializeLayout({
        currentPage: 'assessment-nodes.html',
        breadcrumbs: [
          { name: 'Clinical', href: '#' },
          { name: 'Assessment Templates', href: 'assessment-templates.html' },
          { name: 'PHQ-9', href: 'assessment-template-view.html' },
          { name: 'Nodes', href: 'assessment-nodes.html' }
        ],
        user: currentUser
      });
      
      renderTable();
    });
    
    function renderTable(data = nodesData) {
      const tbody = document.getElementById('nodesTableBody');
      
      tbody.innerHTML = data.map((node) => `
        <tr class="${node.isRoot ? 'root-node-row' : ''}">
          <td>${node.id}</td>
          <td>
            ${node.isRoot 
              ? `<span style="color: var(--color-text-muted); font-weight: 500;">${node.title}</span>`
              : `<a href="assessment-node-view.html?id=${node.id}" class="table-link">${node.title}</a>`
            }
          </td>
          <td>
            <span class="node-type-badge ${node.nodeTypeClass}">
              ${node.nodeTypeClass === 'question' 
                ? '<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>'
                : node.nodeTypeClass === 'message'
                  ? '<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg>'
                  : '<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg>'
              }
              ${node.nodeType}
            </span>
          </td>
          <td>
            ${node.queryType 
              ? `<span class="query-type-badge">${node.queryType}</span>` 
              : '<span style="color: var(--color-text-muted); font-size: 0.875rem;">Not specified</span>'
            }
          </td>
          <td style="color: var(--color-text-secondary); font-size: 0.875rem;">
            ${node.tags || '<span style="color: var(--color-text-muted);">Not specified</span>'}
          </td>
          <td>
            <div class="table-actions">
              ${node.isRoot ? `
                <button class="btn btn-icon btn-ghost sm" title="Root node can't be edited" disabled style="opacity: 0.3;">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/>
                    <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/>
                  </svg>
                </button>
                <button class="btn btn-icon btn-ghost sm" title="Root node can't be viewed" disabled style="opacity: 0.3;">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                    <circle cx="12" cy="12" r="3"/>
                  </svg>
                </button>
                <button class="btn btn-icon btn-ghost sm" title="Root node can't be deleted" disabled style="opacity: 0.3;">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="3 6 5 6 21 6"/>
                    <path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
                  </svg>
                </button>
              ` : `
                <a href="assessment-node-view.html?id=${node.id}&edit=true" class="btn btn-icon btn-ghost sm" title="Edit">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/>
                    <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/>
                  </svg>
                </a>
                <a href="assessment-node-view.html?id=${node.id}" class="btn btn-icon btn-ghost sm" title="View">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                    <circle cx="12" cy="12" r="3"/>
                  </svg>
                </a>
                <button class="btn btn-icon btn-ghost sm" onclick="openDeleteModal('${node.id}', '${node.title}')" title="Delete" style="color: var(--color-error-500);">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="3 6 5 6 21 6"/>
                    <path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
                  </svg>
                </button>
              `}
            </div>
          </td>
        </tr>
      `).join('');
    }
    
    function filterNodes() {
      const titleSearch = document.getElementById('searchTitle').value.toLowerCase();
      const nodeTypeSearch = document.getElementById('searchNodeType').value.toLowerCase();
      const tagsSearch = document.getElementById('searchTags').value.toLowerCase();
      
      const filtered = nodesData.filter(n => {
        const matchTitle = n.title.toLowerCase().includes(titleSearch);
        const matchType = n.nodeType.toLowerCase().includes(nodeTypeSearch);
        const matchTags = (n.tags && n.tags.toLowerCase().includes(tagsSearch)) || !tagsSearch;
        return matchTitle && matchType && matchTags;
      });
      
      renderTable(filtered);
    }
    
    function sortTable(column) {
      Toast.info('Sorted by ' + column);
    }
    
    function openDeleteModal(id, name) {
      deleteTargetId = id;
      document.getElementById('deleteNodeName').textContent = name;
      document.getElementById('deleteModal').classList.add('active');
    }
    
    function closeDeleteModal() {
      document.getElementById('deleteModal').classList.remove('active');
      deleteTargetId = null;
    }
    
    function confirmDelete() {
      Toast.success('Assessment node deleted successfully');
      closeDeleteModal();
    }
  </script>
</body>
</html>
