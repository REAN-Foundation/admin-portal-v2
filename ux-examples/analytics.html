<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Analytics - REAN Admin Portal</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    .analytics-tabs {
      display: flex;
      gap: 0.5rem;
      padding: 0.25rem;
      background: var(--color-surface-alt);
      border-radius: var(--radius-lg);
      margin-bottom: 1.5rem;
    }
    
    .analytics-tab {
      padding: 0.75rem 1.5rem;
      border-radius: var(--radius-md);
      font-size: 0.875rem;
      font-weight: 500;
      background: transparent;
      border: none;
      color: var(--color-text-muted);
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .analytics-tab:hover {
      color: var(--color-text);
    }
    
    .analytics-tab.active {
      background: var(--color-surface);
      color: var(--color-primary-500);
      box-shadow: var(--shadow-sm);
    }
    
    .chart-card {
      background: var(--color-surface);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-lg);
      padding: 1.25rem;
      height: 100%;
    }
    
    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }
    
    .chart-title {
      font-size: 1rem;
      font-weight: 600;
    }
    
    .chart-subtitle {
      font-size: 0.8125rem;
      color: var(--color-text-muted);
    }
    
    .chart-container {
      position: relative;
      height: 280px;
    }
    
    .mini-stat {
      text-align: center;
      padding: 1rem;
    }
    
    .mini-stat-value {
      font-size: 2rem;
      font-weight: 700;
      line-height: 1.2;
    }
    
    .mini-stat-label {
      font-size: 0.75rem;
      color: var(--color-text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-top: 0.25rem;
    }
    
    .mini-stat-trend {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      font-size: 0.75rem;
      font-weight: 500;
      margin-top: 0.5rem;
    }
    
    .mini-stat-trend.up { color: var(--color-success-500); }
    .mini-stat-trend.down { color: var(--color-error-500); }
    
    .download-dropdown {
      position: relative;
    }
    
    .download-menu {
      position: absolute;
      top: 100%;
      right: 0;
      margin-top: 0.5rem;
      background: var(--color-surface);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-lg);
      min-width: 140px;
      display: none;
      z-index: 10;
    }
    
    .download-menu.open {
      display: block;
    }
    
    .download-menu a {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.625rem 1rem;
      font-size: 0.875rem;
      color: var(--color-text);
      text-decoration: none;
      transition: background 0.15s;
    }
    
    .download-menu a:hover {
      background: var(--color-surface-alt);
    }
    
    .retention-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 0.25rem;
      font-size: 0.75rem;
    }
    
    .retention-cell {
      aspect-ratio: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius-sm);
      font-weight: 500;
    }
    
    .retention-header {
      background: var(--color-surface-alt);
      color: var(--color-text-muted);
    }
    
    .date-filter {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar"></aside>
    
    <!-- Main Content -->
    <main class="main-content">
      <!-- Navbar -->
      <header class="navbar" id="navbar"></header>
      
      <!-- Page Content -->
      <div class="page-container">
        <div class="page-header" style="display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 1rem;">
          <div>
            <h1 class="page-title">Analytics Dashboard</h1>
            <p class="page-subtitle">Platform statistics and user engagement metrics</p>
          </div>
          <div style="display: flex; align-items: center; gap: 0.75rem;">
            <div class="date-filter">
              <input type="date" class="form-input" value="2025-01-01" style="width: auto;">
              <span style="color: var(--color-text-muted);">to</span>
              <input type="date" class="form-input" value="2025-01-20" style="width: auto;">
            </div>
            <div class="download-dropdown">
              <button class="btn btn-secondary" onclick="toggleDownloadMenu()">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                  <polyline points="7 10 12 15 17 10"/>
                  <line x1="12" y1="15" x2="12" y2="3"/>
                </svg>
                Download
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="6 9 12 15 18 9"/>
                </svg>
              </button>
              <div class="download-menu" id="downloadMenu">
                <a href="#" onclick="downloadReport('json')">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                    <polyline points="14 2 14 8 20 8"/>
                  </svg>
                  JSON
                </a>
                <a href="#" onclick="downloadReport('excel')">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                    <polyline points="14 2 14 8 20 8"/>
                    <line x1="16" y1="13" x2="8" y2="13"/>
                    <line x1="16" y1="17" x2="8" y2="17"/>
                  </svg>
                  Excel
                </a>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Analytics Tabs -->
        <div class="analytics-tabs">
          <button class="analytics-tab active" onclick="switchTab('overview')">Overview</button>
          <button class="analytics-tab" onclick="switchTab('users')">User Stats</button>
          <button class="analytics-tab" onclick="switchTab('demographics')">Demographics</button>
          <button class="analytics-tab" onclick="switchTab('engagement')">Engagement</button>
          <button class="analytics-tab" onclick="switchTab('features')">Feature Specific</button>
        </div>
        
        <!-- Overview Stats Cards -->
        <div class="stat-cards" style="grid-template-columns: repeat(5, 1fr); margin-bottom: 1.5rem;">
          <div class="stat-card">
            <div class="mini-stat">
              <div class="mini-stat-value" style="color: var(--color-primary-500);">24,856</div>
              <div class="mini-stat-label">Total Users</div>
              <div class="mini-stat-trend up">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>
                  <polyline points="17 6 23 6 23 12"/>
                </svg>
                +12.5%
              </div>
            </div>
          </div>
          <div class="stat-card">
            <div class="mini-stat">
              <div class="mini-stat-value" style="color: var(--color-success-500);">18,432</div>
              <div class="mini-stat-label">Active Users</div>
              <div class="mini-stat-trend up">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>
                  <polyline points="17 6 23 6 23 12"/>
                </svg>
                +8.3%
              </div>
            </div>
          </div>
          <div class="stat-card">
            <div class="mini-stat">
              <div class="mini-stat-value" style="color: #8b5cf6;">15,678</div>
              <div class="mini-stat-label">Enrolled</div>
              <div class="mini-stat-trend up">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>
                  <polyline points="17 6 23 6 23 12"/>
                </svg>
                +15.2%
              </div>
            </div>
          </div>
          <div class="stat-card">
            <div class="mini-stat">
              <div class="mini-stat-value" style="color: var(--color-warning-500);">1,245</div>
              <div class="mini-stat-label">Deleted</div>
              <div class="mini-stat-trend down">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="23 18 13.5 8.5 8.5 13.5 1 6"/>
                  <polyline points="17 18 23 18 23 12"/>
                </svg>
                -2.1%
              </div>
            </div>
          </div>
          <div class="stat-card">
            <div class="mini-stat">
              <div class="mini-stat-value" style="color: #14b8a6;">74.1%</div>
              <div class="mini-stat-label">Retention Rate</div>
              <div class="mini-stat-trend up">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>
                  <polyline points="17 6 23 6 23 12"/>
                </svg>
                +3.2%
              </div>
            </div>
          </div>
        </div>
        
        <!-- Charts Row 1 -->
        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
          <div class="chart-card">
            <div class="chart-header">
              <div>
                <div class="chart-title">User Registration Trends</div>
                <div class="chart-subtitle">Monthly new user registrations</div>
              </div>
              <select class="form-input form-select" style="width: auto; font-size: 0.8125rem;">
                <option>Last 12 months</option>
                <option>Last 6 months</option>
                <option>Last 3 months</option>
              </select>
            </div>
            <div class="chart-container">
              <canvas id="registrationChart"></canvas>
            </div>
          </div>
          
          <div class="chart-card">
            <div class="chart-header">
              <div>
                <div class="chart-title">Device Distribution</div>
                <div class="chart-subtitle">Users by device type</div>
              </div>
            </div>
            <div class="chart-container">
              <canvas id="deviceChart"></canvas>
            </div>
          </div>
        </div>
        
        <!-- Charts Row 2 -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
          <div class="chart-card">
            <div class="chart-header">
              <div>
                <div class="chart-title">Active Users Over Time</div>
                <div class="chart-subtitle">Daily active user count</div>
              </div>
            </div>
            <div class="chart-container">
              <canvas id="activeUsersChart"></canvas>
            </div>
          </div>
          
          <div class="chart-card">
            <div class="chart-header">
              <div>
                <div class="chart-title">User Distribution by Role</div>
                <div class="chart-subtitle">Breakdown by user role</div>
              </div>
            </div>
            <div class="chart-container">
              <canvas id="roleChart"></canvas>
            </div>
          </div>
        </div>
        
        <!-- Charts Row 3 -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
          <div class="chart-card">
            <div class="chart-header">
              <div>
                <div class="chart-title">Feature Usage</div>
                <div class="chart-subtitle">Most used platform features</div>
              </div>
            </div>
            <div class="chart-container">
              <canvas id="featureChart"></canvas>
            </div>
          </div>
          
          <div class="chart-card">
            <div class="chart-header">
              <div>
                <div class="chart-title">Assessment Completion Rate</div>
                <div class="chart-subtitle">Completed vs incomplete assessments</div>
              </div>
            </div>
            <div class="chart-container">
              <canvas id="assessmentChart"></canvas>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>
  
  <script src="js/data.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/sidebar.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      initializeLayout({
        currentPage: 'analytics.html',
        breadcrumbs: [
          { name: 'Analytics', href: 'analytics.html' }
        ],
        user: currentUser
      });
      
      initCharts();
    });
    
    function initCharts() {
      // Color palette
      const colors = {
        primary: '#3359ff',
        success: '#10b981',
        warning: '#f59e0b',
        error: '#ef4444',
        purple: '#8b5cf6',
        teal: '#14b8a6',
        pink: '#ec4899',
        primaryLight: 'rgba(51, 89, 255, 0.1)',
        successLight: 'rgba(16, 185, 129, 0.1)'
      };
      
      // Registration Trend Chart
      new Chart(document.getElementById('registrationChart'), {
        type: 'line',
        data: {
          labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
          datasets: [{
            label: 'Registrations',
            data: [1200, 1900, 1700, 2100, 2400, 2200, 2800, 3100, 2900, 3400, 3200, 3800],
            borderColor: colors.primary,
            backgroundColor: colors.primaryLight,
            fill: true,
            tension: 0.4,
            pointBackgroundColor: colors.primary,
            pointBorderColor: '#fff',
            pointBorderWidth: 2,
            pointRadius: 4,
            pointHoverRadius: 6
          }, {
            label: 'Deregistrations',
            data: [200, 180, 220, 190, 250, 230, 210, 280, 260, 300, 270, 310],
            borderColor: colors.error,
            backgroundColor: 'rgba(239, 68, 68, 0.1)',
            fill: true,
            tension: 0.4,
            pointBackgroundColor: colors.error,
            pointBorderColor: '#fff',
            pointBorderWidth: 2,
            pointRadius: 4,
            pointHoverRadius: 6
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                usePointStyle: true,
                padding: 20
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              grid: {
                color: 'rgba(0,0,0,0.05)'
              }
            },
            x: {
              grid: {
                display: false
              }
            }
          }
        }
      });
      
      // Device Distribution Chart
      new Chart(document.getElementById('deviceChart'), {
        type: 'doughnut',
        data: {
          labels: ['Android', 'iOS', 'Web'],
          datasets: [{
            data: [12456, 8234, 4166],
            backgroundColor: [colors.success, colors.primary, colors.purple],
            borderWidth: 0,
            hoverOffset: 8
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          cutout: '65%',
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                usePointStyle: true,
                padding: 20
              }
            }
          }
        }
      });
      
      // Active Users Chart
      new Chart(document.getElementById('activeUsersChart'), {
        type: 'bar',
        data: {
          labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
          datasets: [{
            label: 'Active Users',
            data: [4200, 4800, 5100, 4900, 5300, 3800, 3200],
            backgroundColor: colors.primary,
            borderRadius: 6,
            barThickness: 32
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              grid: {
                color: 'rgba(0,0,0,0.05)'
              }
            },
            x: {
              grid: {
                display: false
              }
            }
          }
        }
      });
      
      // Role Distribution Chart
      new Chart(document.getElementById('roleChart'), {
        type: 'pie',
        data: {
          labels: ['Patients', 'Doctors', 'Caregivers', 'Admins', 'Others'],
          datasets: [{
            data: [18500, 2200, 1800, 450, 1906],
            backgroundColor: [colors.primary, colors.success, colors.warning, colors.purple, colors.teal],
            borderWidth: 2,
            borderColor: '#fff'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                usePointStyle: true,
                padding: 15
              }
            }
          }
        }
      });
      
      // Feature Usage Chart
      new Chart(document.getElementById('featureChart'), {
        type: 'bar',
        data: {
          labels: ['Assessments', 'Medications', 'Appointments', 'Chat', 'Vitals', 'Lab Records'],
          datasets: [{
            label: 'Usage Count',
            data: [8500, 6200, 5800, 7100, 4500, 3200],
            backgroundColor: [colors.primary, colors.success, colors.warning, colors.purple, colors.teal, colors.pink],
            borderRadius: 6,
            barThickness: 28
          }]
        },
        options: {
          indexAxis: 'y',
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            }
          },
          scales: {
            x: {
              beginAtZero: true,
              grid: {
                color: 'rgba(0,0,0,0.05)'
              }
            },
            y: {
              grid: {
                display: false
              }
            }
          }
        }
      });
      
      // Assessment Completion Chart
      new Chart(document.getElementById('assessmentChart'), {
        type: 'line',
        data: {
          labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
          datasets: [{
            label: 'Completed',
            data: [420, 580, 650, 720],
            borderColor: colors.success,
            backgroundColor: colors.successLight,
            fill: true,
            tension: 0.4
          }, {
            label: 'Incomplete',
            data: [180, 150, 120, 95],
            borderColor: colors.warning,
            backgroundColor: 'rgba(245, 158, 11, 0.1)',
            fill: true,
            tension: 0.4
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                usePointStyle: true,
                padding: 20
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              grid: {
                color: 'rgba(0,0,0,0.05)'
              }
            },
            x: {
              grid: {
                display: false
              }
            }
          }
        }
      });
    }
    
    function switchTab(tab) {
      document.querySelectorAll('.analytics-tab').forEach(t => t.classList.remove('active'));
      event.target.classList.add('active');
      Toast.info('Switched to ' + tab + ' view');
    }
    
    function toggleDownloadMenu() {
      document.getElementById('downloadMenu').classList.toggle('open');
    }
    
    function downloadReport(format) {
      document.getElementById('downloadMenu').classList.remove('open');
      Toast.success('Report downloaded as ' + format.toUpperCase());
    }
    
    // Close download menu when clicking outside
    document.addEventListener('click', (e) => {
      if (!e.target.closest('.download-dropdown')) {
        document.getElementById('downloadMenu').classList.remove('open');
      }
    });
  </script>
</body>
</html>
